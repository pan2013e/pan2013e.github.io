'use strict';class SmartWindow{constructor(a){this.contentUrl=a;this.id=`smart-window-${Date.now()}-${Math.floor(1E3*Math.random())}`;this.minHeight=this.minWidth=300;this.isMobile=null;this.windowState="restored";this.awaitingDragFromSpecialState=this.isMinimized=this.isResizing=this.isDragging=!1;this.lastPosition={x:0,y:0};a=Math.min(1E3,.7*window.innerWidth);const b=Math.min(.9*window.innerHeight,1.414*a);this.initialRect={left:(window.innerWidth-a)/2,top:(window.innerHeight-b)/2,width:a,height:b};
this.resizeDirection="";this.snapTarget=null;this.init()}init(){const a=document.getElementById("smart-window-template").content.cloneNode(!0);this.modal=a.querySelector(".smart-window-modal");this.minimizedBar=a.querySelector(".minimized-bar");document.body.appendChild(this.modal);this.modal.id=`modal-${this.id}`;this.minimizedBar.id=`minimized-${this.id}`;this.header=this.modal.querySelector(".modal-header");this.contentEmbedContainer=this.modal.querySelector(".content-embed-container");this.windowTitle=
this.modal.querySelector(".window-title");this.minimizedTitle=this.minimizedBar.querySelector(".minimized-title");this.openInNewTabBtn=this.modal.querySelector(".open-new-tab-btn");this.inactiveOverlay=this.modal.querySelector(".inactive-overlay");this.windowTitle.textContent=this.getFriendlyTitle();this.minimizedTitle.textContent=this.getFriendlyTitle();this.setupOSStyles();this.attachEventListeners();this.open()}getFriendlyTitle(){try{const a=new URL(this.contentUrl,window.location.href);return a.pathname.toLowerCase().endsWith(".pdf")||
a.pathname.toLowerCase().endsWith(".html")?a.pathname.split("/").pop():a.hostname.replace("www.","")}catch(a){return this.contentUrl}}setupOSStyles(){if(0<=navigator.platform.toUpperCase().indexOf("MAC")){this.modal.classList.add("os-mac");var a=this.modal.querySelector(".window-controls");a.append(a.querySelector(".close-btn"),a.querySelector(".minimize-btn"),a.querySelector(".maximize-container"))}else this.modal.classList.add("os-win"),a=this.modal.querySelector(".window-controls"),a.append(a.querySelector(".minimize-btn"),
a.querySelector(".maximize-container"),a.querySelector(".close-btn")),a.querySelectorAll(".control-btn").forEach(b=>b.classList.add("win-btn")),a.querySelector(".close-btn").classList.add("win-close-btn")}loadContent(){if(!this.contentEmbedContainer.hasChildNodes())if(this.contentEmbedContainer.innerHTML="",this.contentUrl.toLowerCase().split("?")[0].endsWith(".pdf"))PDFObject.embed(this.contentUrl,this.contentEmbedContainer,{pdfOpenParams:{view:"FitV"},callback:()=>{}});else{const a=document.createElement("iframe");
a.style.width="100%";a.style.height="100%";a.style.border="none";a.src=this.contentUrl;a.onload=()=>{try{const b=a.contentDocument||a.contentWindow.document;b.querySelector(".page").style.paddingTop="2rem";const d=b.querySelector("#nav-back");d&&(d.style.visibility="hidden");b.querySelectorAll("a").forEach(f=>{f.addEventListener("click",c=>{const e=f.getAttribute("href");e&&e.startsWith("/")&&(c.preventDefault(),c.stopPropagation(),c=e.substring(1),handleLinkClick(c))})})}catch(b){console.warn("Cannot add link listeners to cross-origin iframe:",
this.contentUrl,b)}};this.contentEmbedContainer.appendChild(a)}}open(){this.isMinimized&&(document.getElementById("minimized-bar-container").removeChild(this.minimizedBar),this.isMinimized=!1);this.modal.classList.remove("minimizing","hidden");this.modal.classList.add("opening");setActiveViewer(this);this.handleUIMode(!0);"maximized"===this.windowState?this.maximizeWindow(!1):this.restoreWindow();this.contentEmbedContainer.hasChildNodes()||setTimeout(()=>this.loadContent(),250);this.modal.addEventListener("animationend",
()=>this.modal.classList.remove("opening"),{once:!0});checkAndManageSnapDivider()}close(){this.modal.remove();this.minimizedBar.remove();delete viewers[this.id];checkAndManageSnapDivider();const a=Object.values(viewers).filter(b=>!b.isMinimized);0<a.length&&setActiveViewer(a[a.length-1])}openInNewTab(){window.open(this.contentUrl,"_blank")}setActive(a){a?(this.modal.classList.remove("inactive-window"),this.modal.style.zIndex=51,this.inactiveOverlay.classList.add("hidden")):(this.modal.classList.add("inactive-window"),
this.modal.style.zIndex=50,this.inactiveOverlay.classList.remove("hidden"))}toggleWindowState(){this.isMobile||(this.modal.classList.add("window-transition"),"restored"!==this.windowState?this.restoreWindow():this.maximizeWindow(!0),setTimeout(()=>this.loadContent(),250),setTimeout(()=>this.modal.classList.remove("window-transition"),200))}maximizeWindow(a=!0){a&&"maximized"!==this.windowState&&(this.initialRect={left:this.modal.offsetLeft,top:this.modal.offsetTop,width:this.modal.offsetWidth,height:this.modal.offsetHeight});
this.modal.style.top="0px";this.modal.style.left="0px";this.modal.style.width="100vw";this.modal.style.height="100vh";this.windowState="maximized";this.isMobile||(this.modal.querySelector(".maximize-icon").classList.add("hidden"),this.modal.querySelector(".restore-icon").classList.remove("hidden"));checkAndManageSnapDivider()}restoreWindow(){this.modal.style.top=`${this.initialRect.top}px`;this.modal.style.left=`${this.initialRect.left}px`;this.modal.style.width=`${Math.max(this.initialRect.width,
this.minWidth)}px`;this.modal.style.height=`${Math.max(this.initialRect.height,this.minHeight)}px`;this.windowState="restored";this.modal.querySelector(".maximize-icon").classList.remove("hidden");this.modal.querySelector(".restore-icon").classList.add("hidden");checkAndManageSnapDivider()}minimizeWindow(){this.isMobile||("maximized"!==this.windowState&&(this.initialRect={left:this.modal.offsetLeft,top:this.modal.offsetTop,width:this.modal.offsetWidth,height:this.modal.offsetHeight}),this.modal.classList.add("minimizing"),
this.modal.addEventListener("animationend",()=>{this.modal.classList.add("hidden");this.modal.classList.remove("minimizing");document.getElementById("minimized-bar-container").appendChild(this.minimizedBar);this.isMinimized=!0;checkAndManageSnapDivider();const a=Object.values(viewers).filter(b=>!b.isMinimized);0<a.length?setActiveViewer(a[a.length-1]):activeViewer=null},{once:!0}))}snapLeft(a=!0){a&&"restored"===this.windowState&&(this.initialRect={left:this.modal.offsetLeft,top:this.modal.offsetTop,
width:this.modal.offsetWidth,height:this.modal.offsetHeight});this.modal.style.top="0px";this.modal.style.left="0px";a=.5*window.innerWidth;rightSnappedViewer&&rightSnappedViewer!==this&&(a=window.innerWidth-rightSnappedViewer.modal.offsetWidth);this.modal.style.width=`${a}px`;this.modal.style.height="100vh";this.windowState="snapped-left";this.modal.querySelector(".maximize-icon").classList.remove("hidden");this.modal.querySelector(".restore-icon").classList.add("hidden");checkAndManageSnapDivider()}snapRight(a=
!0){a&&"restored"===this.windowState&&(this.initialRect={left:this.modal.offsetLeft,top:this.modal.offsetTop,width:this.modal.offsetWidth,height:this.modal.offsetHeight});this.modal.style.top="0px";a=.5*window.innerWidth;var b=.5*window.innerWidth;leftSnappedViewer&&leftSnappedViewer!==this&&(b=leftSnappedViewer.modal.offsetWidth,a=window.innerWidth-b);this.modal.style.left=`${b}px`;this.modal.style.width=`${a}px`;this.modal.style.height="100vh";this.windowState="snapped-right";this.modal.querySelector(".maximize-icon").classList.remove("hidden");
this.modal.querySelector(".restore-icon").classList.add("hidden");checkAndManageSnapDivider()}handleUIMode(a=!1){const b=768>window.innerWidth;if(b!==this.isMobile||a){this.isMobile=b;var d=this.modal.querySelector(".window-controls"),f=this.modal.querySelector(".header-spacer");this.minWidth=Math.max(300,.3*window.innerWidth);this.minHeight=Math.max(300,.5*window.innerHeight);this.isMobile?(this.header.style.cursor="default",d.querySelector(".maximize-container").style.display="none",d.querySelector(".minimize-btn").style.display=
"none",this.modal.querySelectorAll(".resize-handle").forEach(c=>c.style.display="none"),f.style.width="0px","maximized"!==this.windowState&&(this.maximizeWindow(!0),setTimeout(()=>this.loadContent(),250))):(this.header.style.cursor="move",d.querySelector(".maximize-container").style.display="block",d.querySelector(".minimize-btn").style.display="flex",this.modal.querySelectorAll(".resize-handle").forEach(c=>c.style.display="block"),setTimeout(()=>{f.style.width=`${d.offsetWidth}px`},1))}}attachEventListeners(){this.modal.querySelector(".close-btn").addEventListener("click",
()=>this.close());this.modal.querySelector(".maximize-btn").addEventListener("click",c=>{c.stopPropagation();this.toggleWindowState()});this.modal.querySelector(".minimize-btn").addEventListener("click",()=>this.minimizeWindow());this.minimizedBar.addEventListener("click",()=>this.open());this.openInNewTabBtn.addEventListener("click",()=>this.openInNewTab());this.header.addEventListener("mousedown",c=>{setActiveViewer(this);c.target.closest("button")||this.isMobile||("restored"!==this.windowState?
this.awaitingDragFromSpecialState=!0:this.isDragging=!0,this.contentEmbedContainer&&(this.contentEmbedContainer.style.pointerEvents="none"),this.lastPosition={x:c.clientX-this.modal.offsetLeft,y:c.clientY-this.modal.offsetTop})});this.modal.querySelectorAll(".resize-handle").forEach(c=>{c.addEventListener("mousedown",e=>{setActiveViewer(this);e.stopPropagation();var g=c.className.match(/resize-handle-([a-z-]+)/)[1];let h=!1;"restored"===this.windowState?h=!0:"snapped-left"===this.windowState&&"right"===
g?h=!0:"snapped-right"===this.windowState&&"left"===g&&(h=!0);leftSnappedViewer&&rightSnappedViewer&&(h=!1);!this.isMobile&&h&&(this.isResizing=!0,this.isDragging=!1,this.contentEmbedContainer&&(this.contentEmbedContainer.style.pointerEvents="none"),this.resizeDirection=g,g=this.modal.getBoundingClientRect(),this.initialRect={left:g.left,top:g.top,width:g.width,height:g.height},this.lastPosition={x:e.clientX,y:e.clientY},document.body.style.userSelect="none")})});this.header.addEventListener("dblclick",
c=>{this.isMobile||c.target.closest("button")||this.toggleWindowState()});this.inactiveOverlay.addEventListener("wheel",()=>setActiveViewer(this),{passive:!0});const a=this.modal.querySelector(".maximize-container"),b=this.modal.querySelector(".snap-popup");let d,f;a.addEventListener("mouseenter",()=>{clearTimeout(f);d=setTimeout(()=>{"maximized"!==this.windowState&&b.classList.remove("hidden")},400)});a.addEventListener("mouseleave",()=>{clearTimeout(d);f=setTimeout(()=>b.classList.add("hidden"),
200)});this.modal.querySelectorAll(".snap-option").forEach(c=>{c.addEventListener("click",e=>{e=e.currentTarget.dataset.action;this.modal.classList.add("window-transition");switch(e){case "maximize":this.maximizeWindow(!0);break;case "snap-left":this.snapLeft(!0);break;case "snap-right":this.snapRight(!0)}b.classList.add("hidden");setTimeout(()=>this.loadContent(),250);setTimeout(()=>this.modal.classList.remove("window-transition"),200)})})}}const snapPreview=document.getElementById("snap-preview");
let viewers={},activeViewer=null,leftSnappedViewer=null,rightSnappedViewer=null,isSnapResizing=!1;const snapDivider=document.getElementById("snap-divider");
function checkAndManageSnapDivider(){rightSnappedViewer=leftSnappedViewer=null;for(const a of Object.values(viewers))a.isMinimized||("snapped-left"===a.windowState?leftSnappedViewer=a:"snapped-right"===a.windowState&&(rightSnappedViewer=a));leftSnappedViewer&&rightSnappedViewer?(snapDivider.classList.remove("hidden"),snapDivider.style.left=`${leftSnappedViewer.modal.offsetWidth}px`):snapDivider.classList.add("hidden")}
snapDivider.addEventListener("mousedown",a=>{a.preventDefault();isSnapResizing=!0;document.body.style.cursor="ew-resize";Object.values(viewers).forEach(b=>{b.contentEmbedContainer&&(b.contentEmbedContainer.style.pointerEvents="none")})});function setActiveViewer(a){a&&a!==activeViewer&&(Object.values(viewers).forEach(b=>b.setActive(b===a)),activeViewer=a)}
window.addEventListener("mousemove",a=>{if(isSnapResizing)a=Math.max(leftSnappedViewer.minWidth,Math.min(a.clientX,window.innerWidth-rightSnappedViewer.minWidth)),leftSnappedViewer.modal.style.width=`${a}px`,rightSnappedViewer.modal.style.left=`${a}px`,rightSnappedViewer.modal.style.width=`${window.innerWidth-a}px`,snapDivider.style.left=`${a}px`;else if(activeViewer&&!activeViewer.isMinimized){if(activeViewer.awaitingDragFromSpecialState){var b=Math.abs(a.clientY-(activeViewer.lastPosition.y+activeViewer.modal.offsetTop));
if(5<Math.abs(a.clientX-(activeViewer.lastPosition.x+activeViewer.modal.offsetLeft))||5<b){activeViewer.awaitingDragFromSpecialState=!1;activeViewer.isDragging=!0;b=activeViewer.lastPosition.x/activeViewer.modal.offsetWidth;activeViewer.modal.classList.remove("window-transition");activeViewer.restoreWindow();activeViewer.lastPosition.x=activeViewer.modal.offsetWidth*b;activeViewer.lastPosition.y=activeViewer.header.offsetHeight/2;b=a.clientY-activeViewer.lastPosition.y;activeViewer.modal.style.left=
`${a.clientX-activeViewer.lastPosition.x}px`;activeViewer.modal.style.top=`${Math.max(0,b)}px`;return}}if(activeViewer.isDragging&&"restored"===activeViewer.windowState)b=a.clientY-activeViewer.lastPosition.y,activeViewer.modal.style.left=`${a.clientX-activeViewer.lastPosition.x}px`,activeViewer.modal.style.top=`${Math.max(0,Math.min(b,window.innerHeight-activeViewer.header.offsetHeight))}px`,15>a.clientY||a.clientY>window.innerHeight-15?(activeViewer.snapTarget="maximize",snapPreview.style.cssText=
"top:0;left:0;width:100vw;height:100vh;",snapPreview.classList.remove("hidden")):15>a.clientX?(activeViewer.snapTarget="left",a="50vw",rightSnappedViewer&&rightSnappedViewer!==activeViewer&&(a=`${window.innerWidth-rightSnappedViewer.modal.offsetWidth}px`),snapPreview.style.cssText=`top:0;left:0;width:${a};height:100vh;`,snapPreview.classList.remove("hidden")):a.clientX>window.innerWidth-15?(activeViewer.snapTarget="right",b=a="50vw",leftSnappedViewer&&leftSnappedViewer!==activeViewer&&(b=leftSnappedViewer.modal.offsetWidth,
a=`${window.innerWidth-b}px`,b=`${b}px`),snapPreview.style.cssText=`top:0;left:${b};width:${a};height:100vh;`,snapPreview.classList.remove("hidden")):(activeViewer.snapTarget=null,snapPreview.classList.add("hidden"));else if(activeViewer.isResizing){b=a.clientX-activeViewer.lastPosition.x;a=a.clientY-activeViewer.lastPosition.y;let {width:d,height:f,left:c,top:e}=activeViewer.initialRect;activeViewer.resizeDirection.includes("right")&&(d=Math.max(activeViewer.minWidth,activeViewer.initialRect.width+
b));activeViewer.resizeDirection.includes("bottom")&&(f=Math.max(activeViewer.minHeight,activeViewer.initialRect.height+a));if(activeViewer.resizeDirection.includes("left")){const g=activeViewer.initialRect.width-b;g>activeViewer.minWidth&&(d=g,c=activeViewer.initialRect.left+b)}activeViewer.resizeDirection.includes("top")&&(b=activeViewer.initialRect.height-a,b>activeViewer.minHeight&&(f=b,e=activeViewer.initialRect.top+a));activeViewer.windowState.includes("snapped")&&(f=activeViewer.initialRect.height,
e=activeViewer.initialRect.top);activeViewer.modal.style.width=`${d}px`;activeViewer.modal.style.height=`${f}px`;activeViewer.modal.style.left=`${c}px`;activeViewer.modal.style.top=`${e}px`}}});
window.addEventListener("mouseup",()=>{isSnapResizing&&(isSnapResizing=!1,document.body.style.cursor="default",leftSnappedViewer&&(leftSnappedViewer.contentEmbedContainer&&(leftSnappedViewer.contentEmbedContainer.style.pointerEvents="auto"),leftSnappedViewer.loadContent()),rightSnappedViewer&&(rightSnappedViewer.contentEmbedContainer&&(rightSnappedViewer.contentEmbedContainer.style.pointerEvents="auto"),rightSnappedViewer.loadContent()));if(activeViewer){activeViewer.contentEmbedContainer&&(activeViewer.contentEmbedContainer.style.pointerEvents=
"auto");activeViewer.awaitingDragFromSpecialState=!1;if(activeViewer.isDragging&&activeViewer.snapTarget){activeViewer.modal.classList.add("window-transition");switch(activeViewer.snapTarget){case "maximize":activeViewer.maximizeWindow(!0);break;case "left":activeViewer.snapLeft(!0);break;case "right":activeViewer.snapRight(!0)}setTimeout(()=>activeViewer.loadContent(),250);setTimeout(()=>activeViewer.modal.classList.remove("window-transition"),200)}snapPreview.classList.add("hidden");activeViewer.snapTarget=
null;activeViewer.isResizing&&setTimeout(()=>activeViewer.loadContent(),50);activeViewer.isDragging=!1;activeViewer.isResizing=!1;document.body.style.userSelect=""}});function createViewer(a){if(a){var b=new SmartWindow(a);viewers[b.id]=b;b.modal.addEventListener("mousedown",()=>setActiveViewer(b),!0)}}function handleLinkClick(a){const b=(new URL(a,window.location.href)).href;(a=Object.values(viewers).find(d=>d.contentUrl===b))?a.open():createViewer(b)}
document.querySelectorAll("a").forEach(a=>{a.addEventListener("click",b=>{if(a&&!a.closest(".smart-window-modal")){const d=a.getAttribute("href");d&&d.startsWith("/")&&(b.preventDefault(),b=d.substring(1),handleLinkClick(b))}})});window.addEventListener("resize",()=>{Object.values(viewers).forEach(a=>{"maximized"===a.windowState?a.maximizeWindow(!1):"snapped-left"===a.windowState?a.snapLeft(!1):"snapped-right"===a.windowState&&a.snapRight(!1);a.handleUIMode()});checkAndManageSnapDivider()});
if(window.location.hash){const a=window.location.hash.substring(1);a&&handleLinkClick(a)}0<Object.keys(viewers).length&&setActiveViewer(Object.values(viewers)[0]);